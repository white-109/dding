<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>강화 시뮬레이터 (완전본)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    .box {
      border: 1px solid #444;
      padding: 15px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 15px;
      margin-right: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .success {
      color: #4caf50;
      font-weight: bold;
    }
    .fail {
      color: #f44336;
      font-weight: bold;
    }
    label {
      margin-right: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>강화 시뮬레이터 (완전본)</h2>

<div class="box">
  <strong>강화 확률</strong><br>
  <label><input type="radio" name="rate" value="0.10"> 10%</label>
  <label><input type="radio" name="rate" value="0.05"> 5%</label>
  <label><input type="radio" name="rate" value="0.03" checked> 3%</label>
  <label><input type="radio" name="rate" value="0.02"> 2%</label>
  <label><input type="radio" name="rate" value="0.01"> 1%</label>
</div>

<div class="box">
  <strong>자동강화 속도</strong><br>
  <label><input type="radio" name="speed" value="2"> 2배속</label>
  <label><input type="radio" name="speed" value="3"> 3배속</label>
  <label><input type="radio" name="speed" value="4" checked> 4배속</label>
</div>

<div class="box">
  <p>결과: <span id="result">-</span></p>
  <p>누적 실패: <span id="failCount">0</span></p>
  <p>강화 시도까지 남은 실패: <span id="remain">-</span></p>
  <p>연속실패해야 하는 횟수: <span id="maxFail">-</span></p>
</div>

<button onclick="enhance()">강화하기</button>
<button onclick="autoEnhance()">자동강화</button>
<button onclick="stopAuto()">자동강화 중단</button>

<script>
  let successRate = 0.03;
  let maxFail = Math.round(1 / successRate) - 1;
  let failCount = 0;

  let autoRunning = false;
  let autoInterval = null;

  // 확률 변경
  function updateRate() {
    successRate = Number(document.querySelector('input[name="rate"]:checked').value);
    maxFail = Math.round(1 / successRate) - 1;
    failCount = 0;
    updateUI("-", false);
  }

  document.querySelectorAll('input[name="rate"]').forEach(radio =>
    radio.addEventListener("change", updateRate)
  );

  // 속도 계산
  function getSpeed() {
    const checked = document.querySelector('input[name="speed"]:checked');
    if (!checked) return 50;

    switch (checked.value) {
      case "2": return 25;
      case "3": return 15;
      case "4": return 5;
      default: return 50;
    }
  }

  // UI 업데이트
  function updateUI(text, isSuccess) {
    const result = document.getElementById("result");
    result.textContent = text;
    result.className = isSuccess ? "success" : "fail";

    document.getElementById("failCount").textContent = failCount;
    document.getElementById("remain").textContent = maxFail - failCount;
    document.getElementById("maxFail").textContent = maxFail;
  }

  // 강화 로직
  function enhance() {
    // 천장 성공
    if (failCount >= maxFail) {
      failCount = 0;
      updateUI("성공 (지금이기회다)", true);
      return "ceiling";
    }

    // 확률 성공
    if (Math.random() < successRate) {
      failCount = 0;
      updateUI("성공", true);
      return "success";
    } 
    // 실패
    else {
      failCount++;
      updateUI("실패", false);
      return "fail";
    }
  }

  // 자동강화
  function autoEnhance() {
    if (autoRunning) return;
    autoRunning = true;

    autoInterval = setInterval(() => {
      const result = enhance();

      // 천장 성공이면 자동강화 중단
      if (result === "ceiling") {
        stopAuto();
      }
    }, getSpeed());
  }

  // 자동강화 중단
  function stopAuto() {
    clearInterval(autoInterval);
    autoRunning = false;
  }

  // 초기 UI
  updateUI("-", false);
</script>

</body>
</html>
