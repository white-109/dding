<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>강화 시뮬레이터</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }
    .box {
      border: 1px solid #444;
      padding: 15px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 15px;
      margin-right: 10px;
      cursor: pointer;
    }
    .success { color: #4caf50; font-weight: bold; }
    .fail { color: #f44336; font-weight: bold; }
    label { margin-right: 10px; cursor: pointer; }
  </style>
</head>
<body>

<h2>강화 시뮬레이터</h2>

<div class="box">
  <strong>강화 확률</strong><br>
  <label><input type="radio" name="rate" value="0.10"> 10%</label>
  <label><input type="radio" name="rate" value="0.05"> 5%</label>
  <label><input type="radio" name="rate" value="0.03" checked> 3%</label>
  <label><input type="radio" name="rate" value="0.02"> 2%</label>
  <label><input type="radio" name="rate" value="0.01"> 1%</label>
</div>

<div class="box">
  <strong>자동강화 속도</strong><br>
  <label><input type="radio" name="speed" value="2"> 2배속</label>
  <label><input type="radio" name="speed" value="3"> 3배속</label>
  <label><input type="radio" name="speed" value="4"> 4배속</label>
</div>

<div class="box">
  <p>결과: <span id="result">-</span></p>
  <p>누적 실패: <span id="failCount">0</span></p>
  <p>강화 시도까지 남은 실패: <span id="remain">-</span></p>
  <p>연속실패해야 하는 횟수: <span id="maxFail">-</span></p>
</div>

<button onclick="enhance()">강화하기</button>
<button onclick="autoEnhance()">자동강화</button>

<script>
  let successRate = 0.03;
  let maxFail = Math.round(1 / successRate) - 1;
  let failCount = 0;
  let autoRunning = false;

  function updateRate() {
    successRate = Number(document.querySelector('input[name="rate"]:checked').value);
    maxFail = Math.round(1 / successRate) - 1;
    failCount = 0;
    updateUI("-", false);
  }

  document.querySelectorAll('input[name="rate"]').forEach(r =>
    r.addEventListener("change", updateRate)
  );

  function getSpeed() {
    const checked = document.querySelector('input[name="speed"]:checked');
    if (!checked) return 500;
    return 500 / Number(checked.value);
  }

  function updateUI(text, success) {
    const result = document.getElementById("result");
    result.textContent = text;
    result.className = success ? "success" : "fail";

    document.getElementById("failCount").textContent = failCount;
    document.getElementById("remain").textContent = maxFail - failCount;
    document.getElementById("maxFail").textContent = maxFail;
  }

  function enhance() {
    // 천장
    if (failCount >= maxFail) {
      failCount = 0;
      updateUI("성공 (지금이기회다)", true);
      return true;
    }

    if (Math.random() < successRate) {
      failCount = 0;
      updateUI("성공", true);
      return true;
    } else {
      failCount++;
      updateUI("실패", false);
      return false;
    }
  }

  function autoEnhance() {
    if (autoRunning) return;
    autoRunning = true;

    const interval = setInterval(() => {
      const success = enhance();

      if (success && failCount === 0) {
        clearInterval(interval);
        autoRunning = false;
      }
    }, getSpeed());
  }

  updateUI("-", false);
</script>

</body>
</html>
